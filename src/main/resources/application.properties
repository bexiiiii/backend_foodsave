# Application Configuration
spring.application.name=foodsave-backend
server.port=8080
server.servlet.context-path=
spring.main.allow-bean-definition-overriding=true
#spring.profiles.active=prod

# Base URL for file uploads (overridden by APP_BASE_URL env var)
app.base-url=${APP_BASE_URL:https://foodsave.kz}

# Security Configuration
# JWT Secret must be >= 64 characters (512 bits) for HS512 algorithm
security.jwt.secret=yaWxiGHZ4K9i2rKFYZq3UcMCeB3vjpXWvLg+5bskQ5I=FoodSaveSecure2026Key
security.jwt.expiration=86400000

# Database Configuration
spring.datasource.url=jdbc:postgresql://10.114.0.4:5432/foodsave
spring.datasource.username=behruz
spring.datasource.password=234Bex456
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA Configuration (Optimized)
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.generate-ddl=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false
spring.jpa.properties.hibernate.default_batch_fetch_size=16

# Отключаем загрузку data.sql
spring.sql.init.mode=never
spring.jpa.defer-datasource-initialization=false

# Connection Pool Configuration (Optimized for Production)
spring.datasource.hikari.maximum-pool-size=30
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.pool-name=FoodSave-HikariCP
spring.datasource.hikari.cache-prep-stmts=true
spring.datasource.hikari.prep-stmt-cache-size=250
spring.datasource.hikari.prep-stmt-cache-sql-limit=2048
spring.datasource.hikari.use-server-prep-stmts=true

# H2 Console - ОТКЛЮЧЕНО В ПРОДАКШЕНЕ (КРИТИЧЕСКАЯ УЯЗВИМОСТЬ!)
spring.h2.console.enabled=false
spring.h2.console.path=/h2-console

# Swagger/OpenAPI Configuration - ОТКЛЮЧЕНО в продакшене для безопасности
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html

# Actuator - ТОЛЬКО health endpoint с базовой информацией
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=never
management.endpoints.enabled-by-default=false
management.endpoint.health.enabled=true

# JWT Configuration
jwt.secret=5367566B59703373367639792F423F4528482B4D6251655468576D5A71347437
jwt.expiration=86400000

# File Upload Configuration
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Logging Configuration
logging.level.org.springframework=INFO
logging.level.com.foodsave=INFO
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
# Скрываем ошибки парсинга HTTP от ботов/сканеров (RTSP атаки)
logging.level.org.apache.coyote.http11=ERROR

# Tomcat настройки для защиты от DDoS атак
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=20
server.tomcat.max-connections=10000
server.tomcat.accept-count=100
server.tomcat.connection-timeout=20000
# Отклонять слишком большие заголовки (защита от атак)
server.max-http-request-header-size=8KB

# Email Configuration
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=your-email@gmail.com
spring.mail.password=your-app-password
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# Disable mail health check (no valid SMTP configured)
management.health.mail.enabled=false

# Telegram Integration
telegram.bot.token=7773680612:AAEusECkUXmf7mTpw1JmMLWE5KQGJ1spYMc

# CORS Configuration
cors.allowed-origins=http://localhost:3000,http://localhost:3002,https://miniapp.foodsave.kz,https://web.telegram.org,https://miniapp.telegram.org,https://t.me
telegram.miniapp.base-url=https://miniapp.foodsave.kz
telegram.support.username=@FoodSave_bot
logging.file.name=server.log
logging.level.com.foodsave.backend=INFO
logging.level.org.springframework.web=WARN
logging.level.com.zaxxer.hikari=INFO
logging.level.org.hibernate=INFO
logging.level.io.lettuce.core=INFO

# Redis Cache Configuration (с fallback если Redis недоступен)
spring.cache.type=redis
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD:STRONG_REDIS_PASSWORD}
spring.data.redis.ssl.enabled=false
spring.data.redis.repositories.enabled=false
spring.data.redis.timeout=2000
spring.cache.redis.time-to-live=600000

# Performance Monitoring
# Медленные запросы (логируем запросы > 2 секунд)
spring.jpa.properties.hibernate.session.events.log.LOG_QUERIES_SLOWER_THAN_MS=2000

# Server optimization
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# Sentry Configuration for Error Tracking
sentry.dsn=https://4248b08190536e7595d9747f14ce4c7f@o4510234395344896.ingest.de.sentry.io/4510726002049104
sentry.send-default-pii=true
sentry.traces-sample-rate=1.0
sentry.environment=${spring.profiles.active}
sentry.enable-tracing=true
sentry.logging.minimum-event-level=error
sentry.logging.minimum-breadcrumb-level=info
